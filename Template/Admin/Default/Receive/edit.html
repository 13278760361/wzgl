<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="keywords" content="">
		<meta name="author" content="xx_xh">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap-datetimepicker.min.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/common.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/publicSty.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/page_element.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/pages-sty.css" />
		<link rel="stylesheet" href="__PUBLIC__/css/purchaseSty.css" />
		<script src="__PUBLIC__/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__PUBLIC__/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
<!-- 		<script src="__PUBLIC__/js/bootstrap-datetimepicker.min.js" type="text/javascript" charset="utf-8"></script> -->
		<script src="__PUBLIC__/js/page_sty_is.js" type="text/javascript" charset="utf-8"></script>
		<title>领用-编辑</title>
		<script type="text/javascript">
			$(function() {
				radioChecked("changeCase");
				radioChecked("agreeyorn");
			})
		</script>
		<script src="__PUBLIC__/js/ronshn.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="__PUBLIC__/js/ronshn.table.js"></script>
		<script src="__PUBLIC__/js/layer/layer.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<!--页面内容-->
		<div class="container-fluid" id="purchase_con">
			<!--页面导航条-->
			<div class="nav notprint">
				<a class="nav-item">库存管理 </a>
				<img src="__PUBLIC__/images/ic_keyboard_arrow_right.png" />
				<a class="nav-item">库存查询 </a>
				<img src="__PUBLIC__/images/ic_keyboard_arrow_right.png" />
				<a class="nav-item">领用查询 </a>
				<img src="__PUBLIC__/images/ic_keyboard_arrow_right.png" />
				<a class="nav-item">编辑 </a>
				<div class="topbtn fr">
			<!-- 		<span class=" fs-14 boxshow03 top-btn" data-toggle="modal" data-target="#myModal">预览</span> -->
					<!-- <span class=" fs-14 boxshow03 top-btn" onclick="window.print()">打印</span> -->
				</div>
			</div>
			<!--内容-->
			<div class="boxshow02 order-card bgc-1">
				<!--表单标题部分 start-->
				<div class="detaile-top dtable">
					<div class="ordernum dtcell">
						<span class="fc-2">单号：</span>
						<span class="fc-6" info-o="ordersn"><?php echo $detaillist[0]['order_sn'];?></span>
					</div>
					<span class="order-tit dtcell">领用申请表</span>
					<div class="grounp order-date dtcell">
						<div class="dtable date-calender">
							<span class="date-calender-name">日期：</span>
							<input type="" class="date-calender-input" id="datetime" info-o="date" value="<?php echo date('Y-m-d',$detaillist[0]['apply_time'])?>" disabled="disabled"/>
						</div>
					</div>
				</div>
				<div class="proposer_de">
					<label>
						<span class="fs-14 fc-2">申请人：</span>
						<input type="text" info-o="applyer" class="associated-drop big-drop list-top-inputboxshadow" value="{$detaillist[0]['applyer']}" <?php if($isReadyCheck==1):?>disabled="disabled"<?php endif;?> />
					</label>
					<label>
						<span class="fs-14 fc-2">部门：</span>
						<select class="position-department-sele bgimg-select" info-o="depart" <?php if($isReadyCheck==1):?>disabled="disabled"<?php endif;?>>
						<?php foreach($list_dep as $v):?>
						<option <?php if($detaillist[0]['depart']==$v['id']):?>selected="selected"<?php endif;?> value="<?php echo $v['id']?>"><?php echo $v['fullname']?></option>
						<?php endforeach;?>
					</select>
					</label>
				</div>
				<!--表单标题部分 end-->
				<!--表单内容部分 start-->
				<div class="table-order-box position-r">
					<table class="table table-bordered check_table addList" id="addList" >
						<thead>
							<tr>
								<td class=order-td-width01></td>
								<td class=order-td-width02 field="assets_name">物品名称</td>
								<td class=order-td-width02 field="id" style="display: none;">物品ID</td>
								<td class=order-td-width02 field="company_name">供应商名称</td>
								<td class=order-td-width02 field="spec">规格型号</td>
								<td class=order-td-width01 field="unit">单位</td>
								<td class=order-td-width01 field="number">数量</td>
								<td class=order-td-width02 field="price">单价</td>
								<td class=order-td-width02 field="price_total">金额</td>
							</tr>
						</thead>
						<tbody>
						<tr>
								<td>
									<div class=order-td-width01>
									<span class="fs-18" onclick="addrow()"> + </span>
									<span class="fs-20" onclick="delrow(this)">-</span>
									</div>
								</td>
								
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r" style="display: none;">
									<input type="text" class="input-td" name='IDinfo'/>
								</td>
								<td class="position-r">
									<input type="text" class="input-td" disabled="disabled" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" disabled="disabled"/>
								</td>
								<td class="position-r">
									<input type="text" class="input-td" disabled="disabled"/>
								</td>
								<td class="position-r">
									<input type="text" class="input-td" name="num" onkeyup="value=value.replace(/[^\d]/g,'')"/>
								</td>
								<td class="position-r">
									<input type="text" class="input-td" name ="price" onkeyup="value=value.replace(/[^\d]/g,'')"/>
								</td>
								<td class="position-r">
									<input type="text" class="input-td priceInput" name="total" disabled="disabled" />
								</td>
							</tr>
						<?php foreach($detaillist as $k=>$v):?>
							<tr>
								<td>
									<div class=order-td-width01>
									<span class="fs-18" <?php if($isReadyCheck==2):?>onclick="addrow()" <?php endif;?>> + </span>
									<span class="fs-20" <?php if($isReadyCheck==2):?>onclick="delrow(this)" <?php endif;?>>-</span>
									</div>
								</td>
								<td class="position-r">
									<input info-e{$k}="assets_name" type="text" class="input-td" value="{$v['assets_name']}" />
								</td>
								<td class="position-r" style="display: none;">
									<input type="text" info-e{$k}="id" class="input-td" value="{$v['b_id']}" name='IDinfo'/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="company_name" class="input-td" value="{$v['company_name']}" disabled="disabled"/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="spec" class="input-td" value="{$v['spec']}" disabled="disabled"/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="unit" class="input-td" value="{$v['unit']}" disabled="disabled"/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="number" class="input-td" name="num" value="{$v['number']}" onkeyup="value=value.replace(/[^\d]/g,'')"/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="price" class="input-td" name ="price" value="{$v['price']}" onkeyup="value=value.replace(/[^\d]/g,'')"/>
								</td>
								<td class="position-r">
									<input type="text" info-e{$k}="price_total" class="input-td priceInput" name="total" value="{$v['price_total']}" disabled="disabled" />
								</td>
							</tr>
						<?php endforeach;?>
						</tbody>
					</table>
						
					<table class="table table-bordered check_table" id="NewOpinion">
						<tr>
							<td colspan="2">合计</td>
							<td colspan="7">
								<input type="text" info-o="total_price" value="<?php echo $detaillist[0]['total_price']?>" disabled="disabled" class="purchase_total"  name="total_price"/>
							</td>
						</tr>
						
						<tr class="purchase_remark">
							<td colspan="2">备注</td>
							<td colspan="7">
								<textarea rows="5" info-o="re_remark" <?php if($isReadyCheck==1):?>disabled="disabled"<?php endif;?>> <?php echo $detaillist[0]['re_remark']?></textarea>
							</td>
						</tr>
						<?php foreach($auditlist as $k=>$v):?>
						<tr class="not_dele" id="add" key="{$k}">
							<td colspan="2" class="purchase_rem">意见</td>
							<td colspan="6">
								<div class="width-all">
									<div class="position-r">
										<span class="prompt-text position-a fc-7">
										<?php if(empty($v['re_reason'])):?>
										原因说明
										<?php endif;?>
										</span>
										<textarea class=" textarea-block bgc-2" disabled="disabled" rows="3" onkeyup="changePlacehoder(this)">{$v['re_reason']}</textarea>
										<input type="text" style="display:none;">
									</div>

									<div class="width-all">
										<div class="department">
											<select onchange="changeSelect($(this))" class="position-department-sele bgimg-select" info-o="department_id" <?php if($isReadyCheck==1):?>disabled="disabled"<?php endif;?>>
														<option value="">请选择</option>
														<volist name="list_dep" id='ld'>
														<option value="{$ld.id}" <?php if($ld['id']==$v['depart_id']):?>selected="selected"<?php endif;?>>{$ld.fullname}</option>
														</volist>
											</select>

											<div class="dsplin signature">
												<div class="signature01" style="top: 0;">
													<?php if($v['signature']):?>
															<span class="signature-mask spanhgt signatureText"><img src="<?php echo $v['signature']?>" alt=""></span>
															<input type="text" class="signature-input sihgt pad15 width-all" onkeyup="changePlacehoder(this)" />
															<input type="text" style="display:none;">
															<?php else:?>
															<span class="signature-mask spanhgt">自动签章</span>
															<input type="text" class="signature-input sihgt" onkeyup="changePlacehoder(this)" value=""/>
															<?php endif;?>
											</div>
										</div>
										<div class="text-right padr15">
													<div class="audit-person">
														<div class="radiocheckitem  fs-16">
															<input type="radio" id="agree"   value="agree">
															<label  class="label-agree <?php if($v['audit_status']==4):?>label-checked<?php endif;?>" for="agree" <?php if($isReadyCheck==1):?>disabled="disabled" <?php endif;?>>同意</label>
														</div>
														<div class="radiocheckitem fs-16">
															<input type="radio" id="disagree"  value="disagree">
															<label class="label-agree <?php if($v['audit_status']==3):?>label-checked<?php endif;?>"  for="disagree" <?php if($isReadyCheck==1):?>disabled="disabled" <?php endif;?>>不同意</label>
														</div>
														<div class="dsplin change-date-box fs-12 fc-2">
															<span>日期：</span>
															<input type="text" readonly   class="change-date" <?php if($v['re_time']):?>value="<?php echo date('Y-m-d',$v['re_time'])?>"<?php else:?>value=""<?php endif;?>/>
														</div>
													</div>
												</div>
									</div>
								</div>
							</td>
							<td class="operaction_box_p">
								<span class="pur_operation_f">操作</span>
								<a <?php if($isReadyCheck==2):?>onclick="delTr(this)" <?php endif;?>class="opinion-dlt-a">删除</a>
							</td>
						</tr>
					<?php endforeach;?>
					</table>
					<div class="position-a addlistrow text-center fs-20" <?php if($isReadyCheck==2):?>onclick="addOpinion('#add','#NewOpinion')" <?php endif;?>>+</div>
				</div>
				<!--表单内容部分 end-->
				<div class="textcenter mrg-t50 notprint">
				<?php if($isReadyCheck==2):?>
					<input type="hidden" info='id' value="{$id}">
					<input type="hidden" info='org_id' value="{$org_id}">
					<span class="back-btn dpl fs-16 boxshow03" poster="info" action="<?php echo U('edit')?>">编辑</span>
				<?php else:?>
					<a href="javascript:history.go(-1)"><span class="back-btn dpl fs-16 boxshow03">返回</span></a>
				<?php endif;?>
				</div>
			</div>
		</div>
		<!--model-->
		<div class="modal fade notprint" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 85%;">
				<div class="modal-content">
					<div class="modal-body">
						<div class=" order-card bgc-1">
							<!--表单标题部分 start-->
							<div class="detaile-top dtable">
					<div class="ordernum dtcell">
						<span class="fc-2">单号：</span>
						<span class="fc-6">512488623</span>
					</div>
					<span class="order-tit dtcell">领用申请表</span>
					<div class="grounp order-date dtcell">
						<div class="dtable date-calender">
							<span class="date-calender-name">日期：</span>
							<input type="" class="date-calender-input" id="datetime" value="2016-11-25" />
						</div>
					</div>
				</div>
				<div class="proposer_de">
					<label>
						<span class="fs-14 fc-2">申请人：</span>
						<input type="text" class="associated-drop big-drop list-top-inputboxshadow"/>
					</label>
					<label>
						<span class="fs-14 fc-2">部门：</span>
						<input type="text" class="associated-drop big-drop list-top-inputboxshadow"/>
					</label>
				</div>
				<!--表单标题部分 end-->
				<!--表单内容部分 start-->
				<div class="table-order-box position-r">
					<table class="table table-bordered check_table" id="NewOpinion">
						<thead>
							<tr>
								<td class=order-td-width01></td>
								<td class=order-td-width02>单号</td>
								<td class=order-td-width02>物品名称</td>
								<td class=order-td-width02>供应商名称</td>
								<td class=order-td-width02>规格型号</td>
								<td class=order-td-width01>单位</td>
								<td class=order-td-width01>数量</td>
								<td class=order-td-width02>单价</td>
								<td class=order-td-width02>金额</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<div class=order-td-width01>
										<span class="fs-18" onclick="addrow()"> + </span>
										<span class="fs-20">-</span>
									</div>
								</td>
								<td class="position-r">
									<input type="text" class="input-td">
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td" />
								</td>
								<td class="position-r">
									<input type="text" class="input-td"/>
								</td>
							</tr>
						</tbody>
					</table>
						
					<table class="table table-bordered check_table" >
						<tr>
							<td colspan="2">合计</td>
							<td colspan="7">
								<input type="text" class="purchase_total" disabled="disabled" />
							</td>
						</tr>
						<tr class="purchase_remark">
							<td colspan="2">备注</td>
							<td colspan="7">
								<textarea rows="5"></textarea>
							</td>
						</tr>
						<tr class="not_dele" id="add">
							<td colspan="2" class="purchase_rem">意见</td>
							<td colspan="6">
								<div class="width-all">
									<div class="position-r">
										<span class="prompt-text position-a fc-7">原因说明</span>
										<textarea class=" textarea-block bgc-2" rows="3" onkeyup="changePlacehoder(this)"></textarea>

										<input type="text" style="display:none;">
									</div>

									<div class="width-all">
										<div class="department">
											<select name="" class="position-department-sele bgimg-select">
												<option value="">研发部</option>
												<option value="">人事部</option>
												<option value="">研发部</option>
											</select>
											<div class="dsplin signature">
												<div class="signature01" style="top: 0;">
													<span class="signature-mask spanhgt">自动签章</span>
													<input type="" class="signature-input sihgt" onkeyup="changePlacehoder(this)" />
													<input type="text" style="display:none;">
												</div>
												<input type="" placeholder="vvvvvv" name="" id="" value="" />
											</div>
										</div>
										<div class="text-right padr15">
											<div class="audit-person">
												<div class="radiocheckitem  fs-16">
													<input type="radio" id="agree" checked="checked" name="agreeyorn" value="agree">
													<label name="agreeyorn" class="label-checked label-agree" for="agree">同意</label>
												</div>
												<div class="radiocheckitem fs-16">
													<input type="radio" id="disagree" name="agreeyorn" value="disagree">
													<label class="label-agree" name="agreeyorn" for="disagree">不同意</label>
												</div>
												<div class="dsplin change-date-box fs-12 fc-2">
													<span>日期：</span>
													<input type="text" class="change-date" readonly />
												</div>
											</div>
										</div>
									</div>
								</div>
							</td>
							<td class="operaction_box_p">
								<span class="pur_operation_f">操作</span>
								<a href="" class="pur_operation_det">删除</a>
							</td>
						</tr>
					</table>
								<!--表单内容部分 end-->
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
						</div>
					</div>
				</div>
			</div>
	</body>
	<script>

		$(function() {
			$(".pur_operation_det").on("click", function() {
				$(this).parent().remove();
			});



$("#addList").on("focus","input[name='total']",function(){
						var goodsid=$(this).parents("tr").find("input[name='IDinfo']").val();
							if(goodsid==''){
								$(this).val('')
							}
							var price  = $(this).parents("tr").find("input[name='price']").val();

							 var num = $(this).parents("tr").find("input[name='num']").val();

							 var total = price * num;

							 $(this).val(total.toFixed(2));
							  SumPrice($(this))
					})


						$("#addList").on("blur","input[name='price']",function(){
							var goodsid=$(this).parents("tr").find("input[name='IDinfo']").val();
							if(goodsid==''){
								$(this).val('')
							}
							var _thisValue=$(this).val();
		
						  var num = $(this).parents("tr").find("input[name='num']").val();

							 var total = _thisValue * num;

							  $(this).parents("tr").find("input[name='total']").val(total.toFixed(2));
							   SumPrice($(this))
					})
						$("#addList").on("blur","input[name='num']",function(){
							var goodsid=$(this).parents("tr").find("input[name='IDinfo']").val();
							if(goodsid==''){
								$(this).val('')
							}
							var _thisValue=$(this).val();
		
						  var price = $(this).parents("tr").find("input[name='price']").val();

							 var total = _thisValue * price;

							  $(this).parents("tr").find("input[name='total']").val(total.toFixed(2));

							  SumPrice($(this))
					})

		});

var weburl="/Admin/Receive/goodsList?org_id={$org_id}";
// var t=new Table('#addList',{submit:'ni',input:'order_sn',data:dd}).addrow();
var t=new Table('#addList',{submit:'info',input:'assets_name',search:'assets_name',data:weburl}).addrow();
	function SumPrice(_this){
			var IDinfo=_this.parents("tr").find("input[name='IDinfo']").val();
		  // alert(IDinfo)
		  if(IDinfo>0){

				var total = 0;
				var inpt = $(".addList tr input[name='total']");
				for(var i=0;i<inpt.length;i++){
					total+=Number(inpt.eq(i).val());
				}
				$("input[name='total_price']").val(total.toFixed(2));
				 }
		}
	function delrow(o){
		var inpt = $(".addList tr input[name='num']");
		inpt[0].focus();
		t.delrow(o.closest('tr'));
	}
	function addrow(){
		t.addrow();
	}
	function delTr(obj){
				// if ( $(obj).parents('tr').hasClass('not_dele') ) {
				// 	return;
				// }
				if ( $(obj).parents('tr').attr('key') == 0 ) {
					return;
				}
               $(obj).parents('tr').remove();
			}
	function changeSelect(_this){
	/* 异步调取签名图 */
			var id=_this.val();
			var obj=_this.parent().find('.signatureText');
			// alert(obj.html())
			$.post('<?php echo U("/Admin/Weixiu/ajaxSignature")?>',{'uid':id},function(data){
				// alert('1')
				if(data!=''){
					var str='<img src="'+data+'">';
					obj.html(str);
				}else{
					obj.html('自动签章');
				}
			});
}
	</script>

</html>