<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="author" content="xx_xh">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap-datetimepicker.min.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/publicSty.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/page_element.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/pages-sty.css"/>
    <link rel="stylesheet" href="__PUBLIC__/css/purchaseSty.css"/>
    <link rel="stylesheet" href="__PUBLIC__/css/adjust_IE8.css"/>
    <script src="__PUBLIC__/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <!-- 		<script src="__PUBLIC__/js/bootstrap-datetimepicker.min.js" type="text/javascript" charset="utf-8"></script> -->
    <script src="__PUBLIC__/js/page_sty_is.js" type="text/javascript" charset="utf-8"></script>
    <title>领用-新增</title>
    <script type="text/javascript">
        $(function () {
            radioChecked("changeCase");
            radioChecked("agreeyorn");
        })
    </script>
    <script src="__PUBLIC__/js/ronshn.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="__PUBLIC__/js/ronshn.table.js"></script>
    <script src="__PUBLIC__/js/layer/layer.js" type="text/javascript" charset="utf-8"></script>
    <!-- 时间插件 -->
    <link rel="stylesheet" href="__PUBLIC__/js/datetimepicker/css/datetimepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/js/datetimepicker/css/datetimepicker_blue.css" />
    <link rel="stylesheet" href="__PUBLIC__/js/datetimepicker/css/dropdown.css" />
    <script src="__PUBLIC__/js/datetimepicker/js/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <script src="__PUBLIC__/js/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
    <!-- 时间插件 -->
</head>

<body>
<!--页面内容-->
<div class="container-fluid" id="purchase_con">
    <!--页面导航条-->
    <div class="nav notprint">
        <a class="nav-item">库存管理 </a>
        <img src="__PUBLIC__/images/ic_keyboard_arrow_right.png"/>
        <a class="nav-item">库存查询 </a>
        <img src="__PUBLIC__/images/ic_keyboard_arrow_right.png"/>
        <a class="nav-item">领用查询 </a>
        <img src="__PUBLIC__/images/ic_keyboard_arrow_right.png"/>
        <a class="nav-item">新增 </a>
        <div class="topbtn fr">
            <span class=" fs-14 boxshow03 top-btn" data-toggle="modal" data-target="#myModal">预览</span>
            <span class=" fs-14 boxshow03 top-btn" onclick="window.print()">打印</span>
        </div>
    </div>
    <!--内容-->
    <div class="boxshow02 order-card bgc-1">
        <!--表单标题部分 start-->
        <!--<div class="detaile-top dtable">-->
        <!--<div class="ordernum dtcell">-->
        <!--<span class="fc-2">单号：</span>-->
        <!--<span class="fc-6" ni-o="ordersn"><?php echo $order_sn;?></span>-->
        <!--<?php if($is_supper==1):?>-->
        <!--<span class="fc-2">单位：</span>-->
        <!--<select ni-o="org_id" class="position-department-sele bgimg-select" id='departmentClickBtn'>-->
        <!--<option value="">选择所属单位</option>-->
        <!--<?php foreach($departlist as $v):?>-->
        <!--<option <?php if($did==$v['id']):?>selected="selected"<?php endif;?>value="<?php echo $v['id']?>"><?php echo $v['depart_name']?></option>-->
        <!--<?php endforeach;?>-->
        <!--</select>-->
        <!--<?php endif;?>-->
        <!--</div>-->
        <!--<span class="order-tit dtcell">领用申请表</span>-->
        <!--<div class="grounp order-date dtcell">-->
        <!--<div class="dtable date-calender">-->
        <!--<span class="date-calender-name">日期：</span>-->
        <!--<input type="" class="date-calender-input" id="datetime" ni-o="date" value="<?php echo date('Y-m-d',$timedate)?>" disabled="disabled"/>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->

        <div class="detaile-top dtable">
            <div class="ordernum dtcell">
                <div class="dtable date-calender" style="float: left;">
                    <span class="date-calender-name">日期：</span>
                    <div class="">
                        <input type="" class="date-calender-input" id="starttime" ni-o="date"
                               value="<?php echo date('Y-m-d',$timedate)?>" />
                    </div>
                </div>
                <div style="float: left;">
                    <?php if($is_supper==1):?>
                    <span class="fc-2">单位：</span>
                    <select ni-o="org_id" id='departmentClickBtn'>
                        <option value="">选择所属单位</option>
                        <?php foreach($departlist as $v):?>
                        <option
                        <?php if($did==$v['id']):?>selected="selected"<?php endif;?>value="<?php echo $v['id']?>
                        "><?php echo $v['depart_name']?></option>
                        <?php endforeach;?>
                    </select>
                    <?php endif;?>
                </div>
            </div>
            <span class="order-tit dtcell">领用申请表</span>
            <div class="grounp order-date dtcell">
                <span class="fc-2">单号：</span>
                <span class="fc-6" ni-o="ordersn"><?php echo $order_sn;?></span>
            </div>
        </div>

        <div class="proposer_de mrg10">
            <label>
                <span class="fs-14 fc-2">申请人：</span>
                <input type="text" ni-o="applyer"
                       class="associated-drop big-drop list-top-inputboxshadow" <?php if($did==''&&$is_supper==1):?>
                disabled="disabled"<?php endif;?>/>
            </label>
            <label>
                <span class="fs-14 fc-2">领用部门：</span>
                <select class="position-department-sele bgimg-select" ni-o="depart" <?php if($did==''&&$is_supper==1):?>
                disabled="disabled"<?php endif;?>>
                <option value="">选择部门</option>
                <?php foreach($list_dep as $v):?>
                <option
                <?php if($depart==$v['depart_name']):?>selected="selected"<?php endif;?> value="<?php echo $v['id']?>
                "><?php echo $v['fullname']?></option>
                <?php endforeach;?>
                </select>
            </label>
        </div>
        <!--表单标题部分 end-->
        <!--表单内容部分 start-->
        <div class="table-order-box position-r">
            <table class="table table-bordered addList" id="addList">
                <thead>
                <tr>
                    <td class=order-td-width01></td>

                    <td class=order-td-width02 field="assets_name">物品名称</td>
                    <td class=order-td-width02 field="id" style="display: none;">物品ID</td>
                    <td class=order-td-width02 field="company_name">供应商名称</td>
                    <td class=order-td-width02 field="spec">规格型号</td>
                    <td class=order-td-width01 field="unit">单位</td>
                    <td class=order-td-width01 field="number">数量</td>
                    <td class=order-td-width02 field="price">单价</td>
                    <td class=order-td-width02 field="price_total">金额</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <div class=order-td-width01>
                            <span class="fs-18 jia_ico" <?php if($did==''&&$is_supper==1):?><?php else:?>
                            onclick="addrow()"<?php endif;?>> + </span>
                            <span class="fs-20 jian_ico" <?php if($did==''&&$is_supper==1):?><?php else:?>
                            onclick="delrow(this)"<?php endif;?> >-</span>
                        </div>
                    </td>

                    <td class="position-r">
                        <input type="text" class="input-td" <?php if($did==''&&$is_supper==1):?>
                        disabled="disabled"<?php endif;?>/>
                    </td>
                    <td class="position-r" style="display: none;">
                        <input type="text" class="input-td" name="IDinfo"/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td" disabled="disabled"/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td" disabled="disabled"/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td" disabled="disabled"/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td" 
                               name="num" onkeyup="value=value.replace(/[^\d]/g,'')" <?php if($did==''&&$is_supper==1):?>disabled="disabled"<?php endif;?>/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td" 
                               name="price" <?php if($did==''&&$is_supper==1):?>disabled="disabled"<?php endif;?>/>
                    </td>
                    <td class="position-r">
                        <input type="text" class="input-td priceInput" name="total" disabled="disabled"/>
                    </td>
                </tr>
                </tbody>
            </table>

            <table class="table table-bordered" id="NewOp">
                <tr>
                    <td class="order-td-width02 width240">合计</td>
                    <td colspan="7">
                        <input type="text" class="purchase_total" ni-o="total_price" name="total_price"
                               disabled="disabled"/>
                    </td>
                </tr>

                <tr class="purchase_remark">
                    <td colspan="order-td-width02 width240">备注</td>
                    <td colspan="7">
                        <textarea rows="5" ni-o="re_remark" <?php if($did==''&&$is_supper==1):?>
                        disabled="disabled"<?php endif;?>></textarea>
                    </td>
                </tr>

                <tr class="not_dele" id="add" key="0">
                    <td colspan="9" style="padding: 0 ;">
                        <div class="opinion-row dtable width-all">
                            <div class="bord-r dtcell vtm width239">意见</div>
                            <div class="dtcell pad15 bord-r">
                                <div class="position-r">
                                    <span class="prompt-text position-a fc-7 notprint">原因说明</span>
                                    <textarea class=" textarea-block bgc-2" rows="3" readonly=""
                                              onkeyup="changePlacehoder(this)"></textarea>
                                    <input type="text" style="display:none;">
                                </div>

                                <div class="width-all">
                                    <div class="department">
                                        <select accep-acp="depar" ni-o="department_id"
                                                class="position-department-sele bgimg-select120 fl bgimg-select" <?php if($did==''&&$is_supper==1):?>
                                        disabled="disabled"<?php endif;?>>
                                        <option value="">请选择</option>
                                        <volist name="list_dep" id='ld'>
                                            <option value="{$ld.id}">{$ld.fullname}</option>
                                        </volist>
                                        </select>
                                        <div class="dsplin signature notprint fl_ie">
                                            <div class="signature01">
                                                <span class="signature-mask spanhgt">自动签章</span>
                                                <input type="" class="signature-input sihgt"
                                                       onkeyup="changePlacehoder(this)"/>
                                                <input type="text" style="display:none;">
                                            </div>

                                        </div>
                                    </div>
                                    <div class="text-right padr15">
                                        <div class="audit-person">
                                            <div class="radiocheckitem  fs-16">
                                                <input type="radio" id="agree" value="agree">
                                                <label class="label-agree" for="agree" disabled="disabled">同意</label>
                                            </div>
                                            <div class="radiocheckitem fs-16">
                                                <input type="radio" id="disagree" value="disagree">
                                                <label class="label-agree" for="disagree"
                                                       disabled="disabled">不同意</label>
                                            </div>
                                            <div class="dsplin change-date-box fs-12 fc-2">
                                                <span>日期：</span>
                                                <input type="text" class="change-date" readonly/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dtcell position-r notprint" style="width:120px;">
                                <div class="bgc-2 position-a position-a_top0 width-all delete-opinion">操作</div>
                                <div>
                                    <a class="opinion-dlt-a dele_IE">删除</a>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
            <div class="addlistrow text-center fs-20 fr IE_add_ico margin-top--20"
            <?php if($did==''&&$is_supper==1):?><?php else:?>onclick="addOpinion('#add','#NewOp')"<?php endif;?>>+
        </div>
    </div>
    <!--表单内容部分 end-->
    <div class="textcenter mrg-t50 notprint">
        <?php if($did==''&&$is_supper==1):?>
        <a href="{:U('index')}"><span class="back-btn dpl fs-16 boxshow03">返回</span></a>
        <?php else:?>
        <!-- <input type="hidden" value="{$did}" ni="org_id"> -->
        <span class="back-btn dpl fs-16 boxshow03" poster="ni" action="<?php echo U('add')?>">提交</span>
        <?php endif;?>
    </div>
</div>
</div>
<!--model-->
<div class="modal fade notprint" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" style="width: 85%;">
        <div class="modal-content">
            <div class="modal-body">
                <div class=" order-card bgc-1">
                    <!--表单标题部分 start-->
                    <div class="detaile-top dtable">
                        <div class="ordernum dtcell">
                            <span class="fc-2">单号：</span>
                            <span class="fc-6">512488623</span>
                        </div>
                        <span class="order-tit dtcell">领用申请表</span>
                        <div class="grounp order-date dtcell">
                            <div class="dtable date-calender">
                                <span class="date-calender-name">日期：</span>
                                <input type="" class="date-calender-input" id="datetime" value="2016-11-25"/>
                            </div>
                        </div>
                    </div>
                    <div class="proposer_de">
                        <label>
                            <span class="fs-14 fc-2">申请人：</span>
                            <input type="text" class="associated-drop big-drop list-top-inputboxshadow"/>
                        </label>
                        <label>
                            <span class="fs-14 fc-2">部门：</span>
                            <input type="text" class="associated-drop big-drop list-top-inputboxshadow"/>
                        </label>
                    </div>
                    <!--表单标题部分 end-->
                    <!--表单内容部分 start-->
                    <div class="table-order-box position-r">
                        <table class="table table-bordered check_table" id="NewOpinion">
                            <thead>
                            <tr>
                                <td class=order-td-width01></td>
                                <td class=order-td-width02>单号</td>
                                <td class=order-td-width02>物品名称</td>
                                <td class=order-td-width02>供应商名称</td>
                                <td class=order-td-width02>规格型号</td>
                                <td class=order-td-width01>单位</td>
                                <td class=order-td-width01>数量</td>
                                <td class=order-td-width02>单价</td>
                                <td class=order-td-width02>金额</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <div class=order-td-width01>
                                        <span class="fs-18 jia_ico" onclick="addrow()"> + </span>
                                        <span class="fs-20 jian_ico">-</span>
                                    </div>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td">
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td"/>
                                </td>
                                <td class="position-r">
                                    <input type="text" class="input-td" disabled="disabled"/>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <table class="table table-bordered check_table" id="NewOpinion">
                            <tr>
                                <td colspan="2">合计</td>
                                <td colspan="7">
                                    <input type="text" class="purchase_total" disabled="disabled"/>
                                </td>
                            </tr>
                            <tr class="purchase_remark">
                                <td colspan="2">备注</td>
                                <td colspan="7">
                                    <textarea rows="5"></textarea>
                                </td>
                            </tr>
                            <tr class="not_dele" id="add">
                                <td colspan="2" class="purchase_rem">意见</td>
                                <td colspan="6">
                                    <div class="width-all">
                                        <div class="position-r">
                                            <span class="prompt-text position-a fc-7">原因说明</span>
                                            <textarea class=" textarea-block bgc-2" rows="3"
                                                      onkeyup="changePlacehoder(this)"></textarea>

                                            <input type="text" style="display:none;">
                                        </div>

                                        <div class="width-all">
                                            <div class="department">
                                                <select name="" class="position-department-sele bgimg-select">
                                                    <option value="">研发部</option>
                                                    <option value="">人事部</option>
                                                    <option value="">研发部</option>
                                                </select>
                                                <div class="dsplin signature">
                                                    <div class="signature01" style="top: 0;">
                                                        <span class="signature-mask spanhgt ">自动签章</span>
                                                        <input type="" class="signature-input sihgt"
                                                               onkeyup="changePlacehoder(this)"/>
                                                        <input type="text" style="display:none;">
                                                    </div>
                                                    <input type="" placeholder="vvvvvv" name="" id="" value=""/>
                                                </div>
                                            </div>
                                            <div class="text-right padr15">
                                                <div class="audit-person">
                                                    <div class="radiocheckitem  fs-16">
                                                        <input type="radio" id="agree" checked="checked"
                                                               name="agreeyorn" value="agree">
                                                        <label name="agreeyorn" class="label-checked label-agree"
                                                               for="agree">同意</label>
                                                    </div>
                                                    <div class="radiocheckitem fs-16">
                                                        <input type="radio" id="disagree" name="agreeyorn"
                                                               value="disagree">
                                                        <label class="label-agree" name="agreeyorn"
                                                               for="disagree">不同意</label>
                                                    </div>
                                                    <div class="dsplin change-date-box fs-12 fc-2">
                                                        <span>日期：</span>
                                                        <input type="text" class="change-date" readonly/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="operaction_box_p">
                                    <span class="pur_operation_f">操作</span>
                                    <a class="pur_operation_det">删除</a>
                                </td>
                            </tr>
                        </table>
                        <!--表单内容部分 end-->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade notprint" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog model_dialog_ie"  style="width: 90%;">
            <div class="modal-content">
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">返回</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $(function () {
        $('#starttime').datetimepicker({
                    format: 'yyyy-mm-dd',
                    language:"zh-CN",
                    minView:2,
                    todayBtn:  1,
                    autoclose:true
                });
        $('#departmentClickBtn').change(function (event) {
            // alert(11)
            var id = $(this).val();

            var url = "/Admin/Receive/add?did=" + id;
            window.location.href = url;
        });
        $("#NewOp").on("click", "a.opinion-dlt-a", function () {
            if ($(this).parents('tr').hasClass('not_dele')) {
                return;
            }
            $(this).parents('tr').remove();
        });


        $("#addList").on("focus", "input[name='total']", function () {
            var goodsid = $(this).parents("tr").find("input[name='IDinfo']").val();
            if (goodsid == '') {
                $(this).val('')
            }
            var price = $(this).parents("tr").find("input[name='price']").val();

            var num = $(this).parents("tr").find("input[name='num']").val();

            var total = price * num;

            $(this).val(total.toFixed(2));
            SumPrice($(this))
        })


        $("#addList").on("blur", "input[name='price']", function () {
            var goodsid = $(this).parents("tr").find("input[name='IDinfo']").val();
            if (goodsid == '') {
                $(this).val('')
            }
            var _thisValue = $(this).val();

            var num = $(this).parents("tr").find("input[name='num']").val();

            var total = _thisValue * num;

            $(this).parents("tr").find("input[name='total']").val(total.toFixed(2));
            SumPrice($(this))
        })
        $("#addList").on("blur", "input[name='num']", function () {
            var goodsid = $(this).parents("tr").find("input[name='IDinfo']").val();
            if (goodsid == '') {
                $(this).val('')
            }
            var _thisValue = $(this).val();

            var price = $(this).parents("tr").find("input[name='price']").val();

            var total = _thisValue * price;

            $(this).parents("tr").find("input[name='total']").val(total.toFixed(2));

            SumPrice($(this))
        })


    });
    function SumPrice(_this) {
        var IDinfo = _this.parents("tr").find("input[name='IDinfo']").val();
        // alert(IDinfo)
        if (IDinfo > 0) {

            var total = 0;
            var inpt = $(".addList tr input[name='total']");
            for (var i = 0; i < inpt.length; i++) {
                total += Number(inpt.eq(i).val());
            }
            $("input[name='total_price']").val(total.toFixed(2));
        }
    }
    function delTr(obj) {
        // if ( $(obj).parents('tr').hasClass('not_dele') ) {
        // 	return;
        // }
        if ($(obj).parents('tr').attr('key') == 0) {
            return;
        }
        $(obj).parents('tr').remove();
    }
    var weburl = "/Admin/Receive/goodsList?org_id={$did}";

    var t = new Table('#addList', {submit: 'ni', input: 'assets_name', search: 'assets_name', data: weburl}).addrow();
    function delrow(o) {
        var inpt = $(".addList tr input[name='num']");
        inpt[0].focus();
        t.delrow(o.closest('tr'));
    }
    function changeSelect(_this) {
        /* 异步调取签名图 */
        var id = _this.val();

        var obj = _this.parent().find('.signatureText');
        // alert(obj.html())
        $.post('<?php echo U("Admin/Weixiu/ajaxSignature")?>', {'uid': id}, function (data) {
            if (data != '') {
                var str = '<img src="' + data + '">';
                obj.html(str);
            } else {
                obj.html('自动签章');
            }
        });
    }
    function addrow() {
        t.addrow();
    }
    function showH(){
        $('#myModal .modal-body .showHtml').remove();
        var selectarr=[];//克隆出来的select没有选中状态
        $('select').each(function(){
            var c=$(this).find('option:selected');
            if (c.val()&&c.val()!=0) {
                selectarr.push($(this).find('option:selected').text())
            }else{
                selectarr.push(' ')
            }

        })
        var pr=$('.showHtml');
        if (pr.size()>0) {
            pr.html('');
        }else{
            pr=$('<div class="showHtml"></div>');
            $('#myModal .modal-body').append(pr);
        }

        var html=$('.order-card').clone(true);
        html.removeClass('order-card');
        pr.append(html);
        pr.find('.notprint').remove();
        pr.find('input').each(function(){
            var type=$(this).attr('type');
            if (type=='radio') {
                return true;
            }else{
                if ($(this).hasClass('Prdate')) {
                    $(this).replaceWith('<p style="display:inline-block;width:130px"></p>')
                }else{
                    $(this).replaceWith($(this).val())
                }
            }
        });
        pr.find('textarea').each(function(){
            $(this).replaceWith('<div style="height:70px"></div>')
        });
        pr.find('select').each(function(i){
            $(this).replaceWith('<span>'+selectarr[i]+'</span>')
        });
    }
</script>

</html>